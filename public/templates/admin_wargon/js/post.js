$(function(){$(".btnFormat button").on("click",function(){$(".btnFormat button").removeClass("active"),$(this).addClass("active"),$("#format").val($(this).attr("id").replace("Format","")),$.ajax({url:$("#urlExtraFormat").val(),type:"POST",dataType:"html",data:{_token:$('input[name="_token"]').val(),format:$("#format").val(),id:$("#id").val()},success:function(e){$("#extraFormat").html(e),""!=e?$("#extraFormat").show():$("#extraFormat").hide()}})}),""==$("#format").val()?$(".btnFormat button#standardFormat").trigger("click"):$(".btnFormat button#"+$("#format").val()+"Format").trigger("click"),$.fn.fileupload&&"string"==typeof urlUpload&&urlUpload.length>0&&$("#fileupload").fileupload({url:urlUpload,dataType:"json",disableImageResize:!0,imageCrop:!0,done:function(e,t){$.each(t.result.files,function(e,t){$("#imageBoxHolder").val((""!=$("#imageBoxHolder").val()?$("#imageBoxHolder").val()+",":"")+t.name),$("#imageBoxHolder").trigger("loadImg",t.name)})},progressall:function(e,t){var a=parseInt(t.loaded/t.total*100,10);$("#progress .progress-bar").css("width",a+"%")}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled"),""!=$("#imageBoxHolder").val()&&setTimeout(function(){$("#imageBoxHolder").trigger("loadImg",[$("#imageBoxHolder").val(),controller,$("#id").val(),$("#imageField").val()])},100),$("#imageBoxHolder").on("loadImg",function(e,t,a,r,n){$.ajax({url:$("#urlImageBoxHolder").val(),type:"POST",dataType:"html",data:{_token:$('input[name="_token"]').val(),images:t,controller:a,id:r,active:n},success:function(e){""!=e&&$("#fileInputReturn").append(e)}})}),$(this).on("click",".doPrimary, .doDelete",function(e){e.preventDefault();var t=$(this),a=t.closest(".thumbnail").find("img").attr("src"),r=t.attr("href");if($(this).hasClass("doDelete")&&!confirm("Delete this image?"))return!1;$.ajax({url:r,type:"POST",data:{_token:$('input[name="_token"]').val(),filename:basename(a),controller:controller,id:$("#id").val()},success:function(){t.hasClass("doDelete")?t.closest(".thumbnail").parent().remove():($("#fileInputReturn .thumbnail").removeClass("has-primary"),t.closest(".thumbnail").addClass("has-primary")),$("#imageBoxHolder").trigger("updateImg")}})}),$("#imageBoxHolder").on("updateImg",function(){var e=[];$.each($("#fileInputReturn .thumbnail img"),function(){e.push(basename($(this).attr("src")))}),$("#imageBoxHolder").val(e.join(","))}),$("#btnAddFeature").on("click",function(){inputAddFeature=$('input[name="addFeature"]'),""!=inputAddFeature.val()&&$.ajax({url:$("#urlAddFeature").val(),type:"POST",data:{_token:$('input[name="_token"]').val(),feature:inputAddFeature.val()},success:function(e){inputAddFeature.val(null),$("#message").html('<div class="alert alert-success animated fadeIn" role="alert">Feature added.</div>'),$(document).trigger("loadFeatureList")}})}),$("#btnDeleteFeature").on("click",function(){feature=$("#featureList").val(),$.ajax({url:$("#urlDeleteFeature").val(),type:"POST",data:{_token:$('input[name="_token"]').val(),feature:feature},success:function(e){$("#message").html('<div class="alert alert-success animated fadeIn" role="alert">Feature deleted.</div>'),$('#featureList option[value="'+feature+'"]').remove()}})}),setTimeout(function(){$(document).trigger("loadFeatureList")},0),$(this).on("loadFeatureList",function(){$.ajax({url:$("#urlLoadFeatureList").val(),type:"POST",data:{_token:$('input[name="_token"]').val(),feature:$('textarea[name="feature"]').val()},success:function(e){e.features.length>0&&$("#featureList").find("option").remove(),$.each(e.features,function(e,t){$("#featureList").append('<option value="'+t+'">'+t+"</option>")}),e.features.length>0&&$("#featureList, #btnCreateFeature, #btnDeleteFeature").prop("disabled",!1)}})}),$("#btnCreateFeature").on("click",function(){if($("#featureList, #btnCreateFeature, #btnDeleteFeature").prop("disabled",!0),0==$("#featureList option").length)return $("#featureList").prop("disabled",!0),!1;feature=$("#featureList").val(),$.ajax({url:$("#urlCreateFeature").val(),type:"POST",data:{_token:$('input[name="_token"]').val(),feature:feature},success:function(e){$("#message").html('<div class="alert alert-success animated fadeIn" role="alert">Feature created.</div>'),$('#featureList option[value="'+feature+'"]').remove(),$("#featureData").append(e),$("#featureList, #btnCreateFeature, #btnDeleteFeature").prop("disabled",!1)}})}),$(this).on("click",".btnRemoveFeature",function(){if(!confirm("Delete this feature?"))return!1;$(this).closest("dl").remove(),$(document).trigger("loadFeatureList"),$(document).trigger("updateFeatureData")}),$(this).on("click",".btnAddOption",function(){dl=$(this).closest("dl"),feature=dl.data("feature"),input='<div class="input-group"><input class="form-control" placeholder="Enter '+feature+' value..." name="'+feature+'[]" type="text" /><span class="input-group-btn"><button class="btn btn-sm btn-default removeOption" type="button"><i class="fa fa-times"></i></button></span></div>',dl.find(".form-group").append(input),dl.find('.optGroup input[type="text"]:last').focus()}),$(this).on("click",".removeOption",function(){$(this).closest(".optGroup").children().length>1&&($(this).closest(".input-group").remove(),$(document).trigger("updateFeatureData"))}),""!=$('textarea[name="feature"]').val()&&$.ajax({url:$("#urlGenerateFeature").val(),type:"POST",data:{_token:$('input[name="_token"]').val(),feature:$('textarea[name="feature"]').val()},success:function(e){$("#featureData").html(e)}}),$(this).on("click",".btnSave, .btnSaveAdd, .btnSaveClose",function(){$(document).trigger("updateFeatureData")}),$("#featureData input"),$(this).on("keyup",'#featureData input[type="text"]',function(){$(document).trigger("updateFeatureData")}),$(this).on("updateFeatureData",function(){var e={};$('textarea[name="feature"]').val(""),$("#featureData dl").each(function(t,a){var r=$(this);r.find(".form-group input").each(function(t,a){$.isArray(e[r.data("feature")])||(e[r.data("feature")]=[]),""!=a.value&&e[r.data("feature")].push(a.value)})}),$('textarea[name="feature"]').val(JSON.stringify(e))})});